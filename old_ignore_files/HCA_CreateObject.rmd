---
title: "R Notebook"
output: html_notebook
---

# Download data
```{r}
# create folders
dir.create("data/HCA")
dir.create("data/HCA_metadata")
# count matrix
download.file("https://storage.googleapis.com/datarepo-01f25238-bucket/1bea590f-56f7-46c5-891f-5ef121ba83f4/730d25eb-683d-482c-b395-358969b21131/1M-immune-human-immune-10XV2.loom?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=datarepo-jade-api%40terra-datarepo-production.iam.gserviceaccount.com%2F20230424%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20230424T093348Z&X-Goog-Expires=900&X-Goog-SignedHeaders=host&requestedBy=azul-ucsc-0-public-prod%40platform-hca-prod.iam.gserviceaccount.com&userProject=datarepo-cde3a08e&X-Goog-Signature=a8fa84387bef6dd6a518e08f484de37a00ac791cad4d87a498668e8c78246613e7d5cabf449232f133d592701be4be655dff94b2cae698752aa9c4274b7aeec7bc14accd3734aeeca78e182e454c2ac0016facccd982d42de2d33b38ae006fd6ab308edf594b83bc0c0884fa1f5df7610ac79430be785136653a63176ced54d6dc49cf08933e07d82d674a4648a10a44d77facef07e96541e2ae5579f104ca9086787655a57093860d8f69f0404234718f6d45e064091e91b5d9e2e0b403f06afcff43cab1ff19ddc1ebfed7b63096f5621caaeac1a48b0cb79bf0184d17b8f0cd89c0217a0d603113e36a8ea42fd6e698319ecc8a913ea89395f3b1d0b26f65",
destfile = "data/HCA/1M-immune-human-immune-10XV2.loom")
# cell metadata
download.file("https://storage.googleapis.com/datarepo-01f25238-bucket/1bea590f-56f7-46c5-891f-5ef121ba83f4/730d25eb-683d-482c-b395-358969b21131/1M-immune-human-immune-10XV2.loom?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=datarepo-jade-api%40terra-datarepo-production.iam.gserviceaccount.com%2F20230424%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20230424T092612Z&X-Goog-Expires=900&X-Goog-SignedHeaders=host&requestedBy=azul-ucsc-0-public-prod%40platform-hca-prod.iam.gserviceaccount.com&userProject=datarepo-cde3a08e&X-Goog-Signature=afbf9e816c1559f6011ab18c0f42e3d7447678c5255945f7a1d556b02325af1c26ad0ab74faf78687cdbc36bc51f16bb0f850eea7ee433c634f102a1bfa2862226b04da82566a7f2d3611601cb5c016e0c19b34a4d58281cd88d9a8f392c4bd8bbe30b15c363b903c0f4f3d8fb9d082995fab003588081353e1feb90d4acb17b40f1b8b6ea2d7f4e8c7de41e77e1afe9e0f9a65743ea6ec1bdf7d071457eff9d8596e974927793ab0cca4a3cb6fbe3c3c3d30d5f0b307d447cbf8e6d46f7fa0a89d3dc9ed127f0b13bcf0c4a77a052ef77adfae1371548e60f54cee47768aa0ff2ceaa094c0c8ed64a9510f268139abb7266e9d6a9434b17af071e6b0fb9d1ed",
destfile = "data/HCA_metadata/CensusImmune-BoneMarrow-10x_cell_type_2020-03-12.csv")

```


# Load
## Libraries
```{r load libraries}
library(SeuratDisk)
library(Seurat)
```

## Load data
This takes forever.
```{r load data}
HCA.immune <- Connect("data/HCA/1M-immune-human-immune-10XV2.loom")
HCA.Seurat <- as.Seurat(HCA.immune)
HCA.immune$close_all() # closes connection to loom file
```

## Load metadata
```{r load metadata}
HCA.metadata <- read.csv("data/HCA_metadata/CensusImmune-BoneMarrow-10x_cell_type_2020-03-12.csv")

```
# Save object
```{r save object}
saveRDS(HCA.Seurat, "data/HCA/HCA.Seurat.rds")
```
