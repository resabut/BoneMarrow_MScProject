---
title: "Progenitor Analysis"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# image size
options(jupyter.plot_mimetypes = 'image/png',
        repr.plot.width=6,
        repr.plot.height=4)
```
# Load
## load packages
```{r load packages, message=FALSE, warning=FALSE}
library(Seurat)
library(dplyr)
library(ggplot2)
library(tidyr)
library(dittoSeq)
library(patchwork)
library(clustree)
```

## load data
```{r load data}
# load data
bm <- readRDS("data/DISCO/bmv2_fixed.rds")
```
# Subset for Progenitor cells


We can use the simplified annotation to subset for progenitor cells.
```{r subset}
# subset for CD34+ cells
bm.progenitors <- subset(bm, subset = simplified_ct == "Progenitor cells")
# take only those with sex information
bm.progenitors <- subset(bm.progenitors, subset = gender %in% c("F", "M"))
# only that can be classified under 45
bm.progenitors <- subset(bm.progenitors, subset = age_groups == "under 45")
```
# Re-process
```{r reprocess}

bm.progenitors <- FindVariableFeatures(object = bm.progenitors)
# reintegrate data
bm.progenitors <- ScaleData(object = bm.progenitors)
bm.progenitors <- RunPCA(object = bm.progenitors)
bm.progenitors <- FindNeighbors(object = bm.progenitors)
bm.progenitors <- FindClusters(object = bm.progenitors)
bm.progenitors <- RunUMAP(object = bm.progenitors, dims = 1:30)
DimPlot(object = bm.progenitors, reduction = "umap", group.by = "ct", label = TRUE)
```


## save subset data
```{r save subset}
saveRDS(bm.progenitors, "data/DISCO/bmv2_fixed_progenitors.rds", compress = FALSE)
```


